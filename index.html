<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Renuar â€“ ××¢×¨×›×ª ×—× ×•×ª: ××§×´×˜, ××œ××™, ××›×™×¨×•×ª, ×©×¢×•×ª ×•××“××™×Ÿ</title>
<meta name="description" content="××¢×¨×›×ª ×¦×•×•×ª ×œ×—× ×•×ª: ×—×™×¤×•×© ××•×¦×¨×™×, × ×™×”×•×œ ××œ××™, ××›×™×¨×•×ª, ×™×¢×“×™×, ×©×¢×•×ª ×¢×‘×•×“×”, ×—×•×¡×¨×™× ×•××©×ª××©×™×.">
<style>
  :root{
    --bg:#0b0e14;--bg2:#0f1320;--card:#121827;--muted:#a6b2c6;--text:#eef2f7;
    --accent:#6aa5ff;--accent2:#b67cff;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444;
    --ring:#2b3550;--radius:16px;--shadow:0 18px 45px rgba(0,0,0,.35)
  }
  [data-theme="light"]{
    --bg:#f7f8fb;--bg2:#eef1f8;--card:#ffffff;--muted:#5f6b7a;--text:#0e1220;
    --accent:#3e8ef7;--accent2:#8a5cf6;--ring:#dfe5f2;--shadow:0 18px 45px rgba(0,0,0,.08)
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--text);font-family:"Heebo","Arial",sans-serif;
    background:
      radial-gradient(1200px 800px at 10% -10%,#1e2b55 0%,transparent 60%),
      radial-gradient(900px 900px at 110% 0%,#2a194d 0%,transparent 55%),
      linear-gradient(180deg,var(--bg),var(--bg2) 60%,var(--bg));
  }
  [data-theme="light"] body{
    background:linear-gradient(180deg,var(--bg),var(--bg2) 60%,var(--bg));
  }
  header{position:sticky;top:0;z-index:50;border-bottom:1px solid #1f2740;background:rgba(10,14,25,.6);backdrop-filter:blur(10px)}
  [data-theme="light"] header{background:rgba(255,255,255,.65);border-bottom-color:#e6e9f2}
  .wrap{max-width:1160px;margin:auto;padding:16px}
  .hero{display:flex;align-items:center;gap:14px;justify-content:space-between}
  .logo{display:flex;align-items:center;gap:12px}
  .badge{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 0deg,var(--accent),var(--accent2),var(--accent));display:grid;place-items:center;font-weight:800;color:#0c1020;box-shadow:0 6px 16px rgba(106,165,255,.35)}
  .logo span{font-weight:900;letter-spacing:.3px}
  nav{display:flex;gap:8px;flex-wrap:wrap}
  .btn{position:relative;overflow:hidden;isolation:isolate;border:1px solid var(--ring);background:#121627;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;transition:.18s;box-shadow:0 4px 18px rgba(0,0,0,.18)}
  [data-theme="light"] .btn{background:#fff}
  .btn:hover{transform:translateY(-1px);border-color:#36406a}
  [data-theme="light"] .btn:hover{border-color:#cfd7ea}
  .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#0c1020;font-weight:800}
  .btn.ghost{background:transparent}
  .btn:active{transform:translateY(0)}
  .btn[type="button"]{/* Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… submit */}
  .ripple{position:relative;overflow:hidden}
  .ripple span.rp{position:absolute;border-radius:50%;transform:scale(0);animation:ripple .6s linear;background:rgba(255,255,255,.28)}
  @keyframes ripple{to{transform:scale(12);opacity:0}}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:rgba(14,18,32,.72);border:1px solid #1b2240;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  [data-theme="light"] .card{background:#fff;border-color:#e9edf7}
  h1,h2,h3{margin:0 0 10px}
  .muted{color:var(--muted)}
  label{display:block;color:#cbd6ec;margin:6px 0 6px;font-size:.95rem}
  [data-theme="light"] label{color:#334155}
  input,select,textarea{width:100%;padding:12px 13px;border-radius:12px;border:1px solid #233055;background:#0d1220;color:var(--text);outline:none;transition:.18s}
  [data-theme="light"] input,[data-theme="light"] select,[data-theme="light"] textarea{background:#fff;border-color:#d6deef;color:#0e1220}
  input:focus,textarea:focus,select:focus{border-color:#4060ff;box-shadow:0 0 0 3px rgba(64,96,255,.12)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
  .pill{display:inline-flex;gap:8px;align-items:center;background:#12162b;border:1px solid #26335e;border-radius:999px;padding:6px 10px;font-size:.9rem}
  [data-theme="light"] .pill{background:#f3f6ff;border-color:#dbe4fb}
  .list{display:grid;gap:12px}
  .prod{display:grid;grid-template-columns:110px 1fr;gap:14px;align-items:center}
  .prod img{width:110px;height:110px;object-fit:cover;border-radius:14px;border:1px solid #26335e;background:#0e1018}
  [data-theme="light"] .prod img{border-color:#e6eaf7;background:#f7f8fd}
  .table{width:100%;border-collapse:collapse;overflow:hidden;border-radius:14px;border:1px solid #27335f}
  [data-theme="light"] .table{border-color:#e6eaf7}
  .table th,.table td{padding:10px;border-bottom:1px solid #27335f;text-align:right}
  [data-theme="light"] .table th,[data-theme="light"] .table td{border-bottom-color:#e6eaf7}
  .table th{background:#12162b;color:#cfd6e4}
  [data-theme="light"] .table th{background:#f4f7ff;color:#334155}
  .empty{border:1px dashed #2a355f;border-radius:12px;padding:14px;text-align:center;color:#97a5c4}
  [data-theme="light"] .empty{border-color:#cad5f5;color:#6b7280}
  footer{opacity:.75;text-align:center;padding:28px 0}
  .tabs{display:flex;gap:8px;margin:8px 0 14px;flex-wrap:wrap}
  .tabs .btn{padding:8px 10px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .skeleton{background:linear-gradient(90deg,#0f1426 0%,#18213e 50%,#0f1426 100%);background-size:200% 100%;animation:sk 1.2s infinite}
  @keyframes sk{to{background-position:-200% 0}}
  .toast{position:fixed;bottom:18px;inset-inline:0;display:grid;justify-items:center;z-index:60;pointer-events:none}
  .toast .msg{pointer-events:auto;min-width:220px;max-width:90%;background:#10162a;border:1px solid #26335e;box-shadow:var(--shadow);color:var(--text);padding:10px 14px;border-radius:12px;display:flex;gap:10px;align-items:center;animation:pop .2s ease-out}
  .msg.ok{border-color:#244e35}.msg.warn{border-color:#5a441f}.msg.danger{border-color:#5a2222}
  [data-theme="light"] .toast .msg{background:#ffffff;border-color:#e6eaf7}
  @keyframes pop{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}
  .view{opacity:0;transform:translateY(8px);transition:.18s}.view.active{opacity:1;transform:none}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .switch{display:inline-flex;align-items:center;gap:8px}
</style>
</head>
<body>
<header>
  <div class="wrap hero">
    <div class="logo">
      <div class="badge">R</div>
      <span>Renuar â€“ ××¢×¨×›×ª ×¦×•×•×ª</span>
    </div>
    <nav class="toolbar">
      <button class="btn ripple" type="button" onclick="showView('search')">ğŸ” ×—×™×¤×•×©</button>
      <button class="btn ripple" type="button" onclick="showView('shortage')">ğŸ“ ×—×•×¡×¨×™×</button>
      <a class="btn ripple" href="https://www.renuar.co.il" target="_blank" rel="noopener">ğŸ› Renuar</a>
      <button id="loginBtn" class="btn primary ripple" type="button" onclick="showView('auth')">ğŸ‘¤ ×›× ×™×¡×”</button>
      <button id="adminBtn" class="btn ripple" type="button" style="display:none" onclick="showView('admin')">ğŸ›  × ×™×”×•×œ</button>
      <button id="logoutBtn" class="btn ripple" type="button" style="display:none" onclick="logout()">ğŸšª ×™×¦×™××”</button>
      <div class="switch pill">
        <span>××¦×‘</span>
        <select id="themeSelect" onchange="switchTheme(this.value)">
          <option value="dark">×›×”×”</option>
          <option value="light">×‘×”×™×¨</option>
        </select>
      </div>
    </nav>
  </div>
</header>

<main class="wrap" style="padding-top:18px">
  <!-- SEARCH -->
  <section id="view-search" class="grid view active">
    <div class="card">
      <h2>ğŸ” ×—×™×¤×•×© ××•×¦×¨</h2>
      <p class="muted">×”×§×œ×“ <b>×©×</b> ××• <b>××§×´×˜</b> ×•×œ×—×¥ ×—×¤×©</p>
      <div class="row">
        <div><label>×©× ×¤×¨×™×˜</label><input id="qName" placeholder="×œ×“×•×’××”: ×—×•×œ×¦×ª ×¤×•×œ×•"/></div>
        <div><label>××§×´×˜</label><input id="qSku" placeholder="×œ×“×•×’××”: M250216"/></div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button class="btn primary ripple" type="button" onclick="search()">×—×¤×©</button>
        <button class="btn ripple ghost" type="button" onclick="clearSearch()">× ×§×”</button>
        <span class="pill">×ª×•×¦××•×ª ××§×•××™×•×ª</span>
      </div>
    </div>
    <div class="card" id="searchResults">
      <div class="toolbar" style="justify-content:space-between">
        <h3>×ª×•×¦××•×ª</h3>
        <div class="row" style="grid-template-columns:1fr 1fr;gap:8px;max-width:420px">
          <select id="filterCat">
            <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
            <option>×—×•×œ×¦×•×ª</option><option>×’×³×™× ×¡×™×</option><option>× ×¢×œ×™×™×</option>
          </select>
          <select id="filterPrice">
            <option value="">×›×œ ×”××—×™×¨×™×</option>
            <option value="1">×¢×“ â‚ª100</option>
            <option value="2">â‚ª100â€“â‚ª200</option>
            <option value="3">××¢×œ â‚ª200</option>
          </select>
        </div>
      </div>
      <div id="resultsList" class="list">
        <div class="card skeleton" style="height:92px;border-radius:12px"></div>
        <div class="card skeleton" style="height:92px;border-radius:12px"></div>
      </div>
    </div>
  </section>

  <!-- SHORTAGES -->
  <section id="view-shortage" class="grid view" style="display:none">
    <div class="card">
      <h2>ğŸ“ ×¨×©×™××ª ×—×•×¡×¨×™×</h2>
      <p class="muted">×›×ª×•×‘ ×›××Ÿ ××” ×—×¡×¨ ×‘××—×¡×Ÿ / ×‘×—× ×•×ª. ×”×“×™×•×•×— ×™×•×¤×™×¢ ××¦×œ ×”××“××™×Ÿ.</p>
      <div class="row">
        <div><label>×©× ×¤×¨×™×˜ ×—×¡×¨</label><input id="shortItem" placeholder="×œ×“×•×’××”: ×©×§×™×•×ª"/></div>
        <div><label>×›××•×ª ×“×¨×•×©×”</label><input id="shortQty" type="number" min="1" placeholder="50"/></div>
      </div>
      <div class="row">
        <div><label>×”×¢×¨×•×ª</label><input id="shortNote" placeholder="×¦×‘×¢, ××™×“×”, ×¡×¤×§..."/></div>
        <div style="display:flex;align-items:end"><button class="btn primary ripple" type="button" onclick="submitShortage()">×©×œ×—</button></div>
      </div>
    </div>
    <div class="card">
      <h3>×“×™×•×•×—×™× ××—×¨×•× ×™×</h3>
      <div id="shortUserList" class="list"></div>
    </div>
  </section>

  <!-- AUTH -->
  <section id="view-auth" class="grid view" style="display:none">
    <div class="card">
      <h2>ğŸ‘¤ ×›× ×™×¡×”</h2>
      <div class="row">
        <div><label>×©× ××©×ª××©</label><input id="loginUser" placeholder="admin ××• user"/></div>
        <div><label>×¡×™×¡××”</label><input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/></div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button class="btn primary ripple" type="button" onclick="login()">×›× ×™×¡×”</button>
        <button class="btn ripple" type="button" onclick="showView('register')">×”×¨×©××”</button>
      </div>
      <p class="muted" style="margin-top:10px">âš  ×“××• ××§×•××™ (localStorage) â€“ ××œ ×ª×›× ×™×¡ ×¡×™×¡××” ×××™×ª×™×ª.</p>
      <div class="pill">××“××™×Ÿ ×‘×¨×™×¨×ª ××—×“×œ: <b>admin / 1234</b></div>
    </div>
  </section>

  <!-- REGISTER -->
  <section id="view-register" class="grid view" style="display:none">
    <div class="card">
      <h2>ğŸ†• ×”×¨×©××”</h2>
      <div class="row">
        <div><label>×©× ××©×ª××©</label><input id="regUser" placeholder="user123"/></div>
        <div><label>×¡×™×¡××”</label><input id="regPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/></div>
      </div>
      <div class="row">
        <div><label>×©× ××œ×</label><input id="regFull" placeholder="×©× ×¤×¨×˜×™ + ××©×¤×—×”"/></div>
        <div><label>×ª×¤×§×™×“</label>
          <select id="regRole"><option value="user">××•×›×¨</option><option value="shift">×× ×”×œ ××©××¨×ª</option><option value="admin">××“××™×Ÿ</option></select>
        </div>
      </div>
      <div style="margin-top:10px"><button class="btn primary ripple" type="button" onclick="register()">×¦×•×¨ ×—×©×‘×•×Ÿ</button></div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="view-admin" class="grid view" style="display:none">
    <div class="card">
      <h2>ğŸ›  × ×™×”×•×œ</h2>
      <div class="tabs">
        <button class="btn ripple" type="button" onclick="setAdminTab('products')">ğŸ—‚ ××•×¦×¨×™×</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('inventory')">ğŸ“¦ ××œ××™</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('sales')">ğŸ’¸ ××›×™×¨×•×ª</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('goals')">ğŸ¯ ×™×¢×“×™×</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('time')">ğŸ•’ ×©×¢×•×ª</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('shortages')">ğŸ“ ×—×•×¡×¨×™×</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('users')">ğŸ‘¥ ××©×ª××©×™×</button>
        <button class="btn ripple" type="button" onclick="setAdminTab('reports')">ğŸ“Š ×“×•×—×•×ª</button>
      </div>

      <!-- PRODUCTS -->
      <div id="admin-products">
        <h3>×”×•×¡×¤×ª / ×¢×¨×™×›×ª ××•×¦×¨</h3>
        <div class="row">
          <div><label>×©× ×¤×¨×™×˜</label><input id="pName" placeholder="×—×•×œ×¦×ª ×¤×•×œ×•"/></div>
          <div><label>××§×´×˜ (×™×™×—×•×“×™)</label><input id="pSku" placeholder="M250216"/></div>
        </div>
        <div class="row">
          <div><label>×§×˜×’×•×¨×™×”</label>
            <select id="pCat"><option>×—×•×œ×¦×•×ª</option><option>×’×³×™× ×¡×™×</option><option>× ×¢×œ×™×™×</option><option>××—×¨</option></select>
          </div>
          <div><label>××—×™×¨ â‚ª</label><input id="pPrice" type="number" min="0" step="0.01" placeholder="119.90"/></div>
        </div>
        <div><label>×§×™×©×•×¨ ×ª××•× ×” (URL)</label><input id="pImg" placeholder="https://example.com/img.jpg"/></div>
        <div class="actions" style="margin-top:10px">
          <button class="btn primary ripple" type="button" onclick="saveProduct()">×©××™×¨×”</button>
          <button class="btn ripple" type="button" onclick="clearProductForm()">× ×§×”</button>
          <button class="btn ripple" type="button" onclick="exportData()">ğŸ“¤ ×™×¦×•× JSON</button>
          <label class="btn ripple" for="importFile">ğŸ“¥ ×™×‘×•× JSON</label>
          <input id="importFile" type="file" accept="application/json" style="display:none" onchange="importData(event)"/>
          <button class="btn ripple" type="button" onclick="exportCSV()">ğŸ“„ ×™×¦×•× CSV</button>
        </div>
        <h3 style="margin-top:18px">×›×œ ×”××•×¦×¨×™×</h3>
        <div id="adminProdList" class="list"></div>
      </div>

      <!-- INVENTORY -->
      <div id="admin-inventory" style="display:none">
        <h3>× ×™×”×•×œ ××œ××™</h3>
        <div class="row">
          <div><label>××§×´×˜</label><input id="invSku" placeholder="M250216"/></div>
          <div><label>×›××•×ª</label><input id="invQty" type="number" min="0" placeholder="0"/></div>
        </div>
        <div class="row">
          <div><label>×¡× ×™×£/××™×§×•×</label><input id="invLoc" placeholder="×•×™×œ×’' ××•×œ ×—×“×¨×”"/></div>
          <div><label>××™×“×” / ×¦×‘×¢</label><input id="invAttr" placeholder="S / ×©×—×•×¨"/></div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn primary ripple" type="button" onclick="saveInventory()">×©××™×¨×ª ××œ××™</button>
          <button class="btn ripple" type="button" onclick="clearInvForm()">× ×§×”</button>
        </div>
        <h3 style="margin-top:18px">×¨×©×•××ª ××œ××™</h3>
        <table class="table" id="invTable">
          <thead><tr><th>××§×´×˜</th><th>×›××•×ª</th><th>××™×§×•×</th><th>××™×“×”/×¦×‘×¢</th><th>×¢×•×“×›×Ÿ</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="invEmpty" class="empty" style="display:none">××™×Ÿ ×¨×©×•××•×ª ××œ××™</div>
      </div>

      <!-- SALES -->
      <div id="admin-sales" style="display:none">
        <h3>×¨×™×©×•× ××›×™×¨×”</h3>
        <div class="row">
          <div><label>×¢×•×‘×“</label><select id="saleUser"></select></div>
          <div><label>××§×´×˜</label><input id="saleSku" placeholder="M250216"/></div>
        </div>
        <div class="row">
          <div><label>×›××•×ª</label><input id="saleQty" type="number" min="1" value="1"/></div>
          <div><label>×¡×”×´×› (â‚ª)</label><input id="saleTotal" type="number" min="0" step="0.01" placeholder="0.00"/></div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn primary ripple" type="button" onclick="saveSale()">×©××•×¨ ××›×™×¨×”</button>
          <button class="btn ripple" type="button" onclick="clearSaleForm()">× ×§×”</button>
        </div>
        <h3 style="margin-top:18px">××›×™×¨×•×ª ××—×¨×•× ×•×ª</h3>
        <table class="table" id="salesTable">
          <thead><tr><th>×ª××¨×™×š</th><th>×¢×•×‘×“</th><th>××§×´×˜</th><th>×›××•×ª</th><th>×¡×”×´×›</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="salesEmpty" class="empty" style="display:none">××™×Ÿ ××›×™×¨×•×ª</div>
      </div>

      <!-- GOALS -->
      <div id="admin-goals" style="display:none">
        <h3>× ×™×”×•×œ ×™×¢×“×™×</h3>
        <div class="row">
          <div><label>×™×¢×“ ×™×•××™ (â‚ª)</label><input id="goalDaily" type="number" min="0" step="1" placeholder="2000"/></div>
          <div><label>×™×¢×“ ×©×‘×•×¢×™ (â‚ª)</label><input id="goalWeekly" type="number" min="0" step="1" placeholder="12000"/></div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn primary ripple" type="button" onclick="saveGoals()">×©××•×¨ ×™×¢×“×™×</button>
        </div>
        <div class="pill" id="goalsProgress">×”×ª×§×“××•×ª: â€”</div>
      </div>

      <!-- TIME CLOCK -->
      <div id="admin-time" style="display:none">
        <h3>×©×¢×•×ª ×¢×‘×•×“×”</h3>
        <div class="row">
          <div><label>×¢×•×‘×“</label><select id="timeUser"></select></div>
          <div class="actions" style="align-items:end">
            <button class="btn primary ripple" type="button" onclick="clockIn()">Clock-in</button>
            <button class="btn ripple" type="button" onclick="clockOut()">Clock-out</button>
            <button class="btn ripple" type="button" onclick="exportTimesCSV()">ğŸ“„ ×™×¦×•× ×©×¢×•×ª</button>
          </div>
        </div>
        <h3 style="margin-top:18px">×¨×©×•××•×ª ×©×¢×•×ª</h3>
        <table class="table" id="timeTable">
          <thead><tr><th>×¢×•×‘×“</th><th>×›× ×™×¡×”</th><th>×™×¦×™××”</th><th>×¡×”×´×› (×©×³)</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="timeEmpty" class="empty" style="display:none">××™×Ÿ ×¨×©×•××•×ª</div>
      </div>

      <!-- SHORTAGES (ADMIN) -->
      <div id="admin-shortages" style="display:none">
        <h3>×“×™×•×•×—×™ ×—×•×¡×¨×™×</h3>
        <table class="table" id="shortTable">
          <thead><tr><th>×ª××¨×™×š</th><th>××©×ª××©</th><th>×¤×¨×™×˜</th><th>×›××•×ª</th><th>×”×¢×¨×•×ª</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="emptyShort" class="empty" style="display:none">××™×Ÿ ×“×™×•×•×—×™× ×›×¨×’×¢</div>
      </div>

      <!-- USERS -->
      <div id="admin-users" style="display:none">
        <h3>××©×ª××©×™×</h3>
        <table class="table" id="usersTable">
          <thead><tr><th>×©× ××©×ª××©</th><th>×©× ××œ×</th><th>×ª×¤×§×™×“</th><th>× ×•×¦×¨</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="pill">×œ×¨×™×©×•× ××©×ª××© ×—×“×© â†’ "×”×¨×©××”" ×‘×ª×¤×¨×™×˜</div>
      </div>

      <!-- REPORTS -->
      <div id="admin-reports" style="display:none">
        <h3>×“×•×—×•×ª ×•×’×¨×¤×™×</h3>
        <div class="row">
          <div><label>×˜×•×•×— ×™××™× (××—×•×¨× ×™×ª)</label><input id="repDays" type="number" min="1" value="7"/></div>
          <div class="actions" style="align-items:end">
            <button class="btn primary ripple" type="button" onclick="buildReport()">×—×©×‘</button>
          </div>
        </div>
        <canvas id="chart" width="600" height="280" style="width:100%;border:1px solid var(--ring);border-radius:12px;margin-top:10px;background:#0e1324"></canvas>
        <div id="repSummary" class="pill" style="margin-top:10px">â€”</div>
      </div>
    </div>
  </section>
</main>

<footer><div class="wrap muted">Â© <span id="year"></span> Renuar Demo â€“ ×’×¨×¡×ª ×”×“×’××” ××§×•××™×ª</div></footer>
<div class="toast" id="toast"></div>

<script>
/* ===== Utils & State ===== */
(function ensureUUID(){ if(!('crypto' in window) || !crypto.randomUUID){ window.crypto = window.crypto || {}; crypto.randomUUID = ()=>'id-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2); } })();
const $ = s=>document.querySelector(s);
const LS={get:(k,def)=>{try{return JSON.parse(localStorage.getItem(k))??def}catch{return def}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const toast=(txt,type='ok')=>{ const box=$("#toast"); const m=document.createElement('div'); m.className='msg '+type; m.innerHTML=txt; box.appendChild(m); setTimeout(()=>m.remove(),2500); };
const ripple=(e)=>{ const b=e.currentTarget; const r=document.createElement('span'); r.className='rp'; const rect=b.getBoundingClientRect(); const d=Math.max(rect.width,rect.height); r.style.width=r.style.height=d+'px'; r.style.left=(e.clientX-rect.left-d/2)+'px'; r.style.top=(e.clientY-rect.top-d/2)+'px'; b.appendChild(r); setTimeout(()=>r.remove(),600); };
document.addEventListener('click',e=>{ if(e.target.classList.contains('ripple')) ripple(e); });

/* Theme */
function switchTheme(v){ document.documentElement.setAttribute('data-theme', v==='light'?'light':'dark'); LS.set('theme', v); }
switchTheme(LS.get('theme','dark')); $("#themeSelect").value = LS.get('theme','dark');

/* Seed */
(function seed(){
  if(!LS.get('users')) LS.set('users',[{username:'admin',full:'×× ×”×œ ××¢×¨×›×ª',pass:'1234',role:'admin',created:Date.now()}]);
  if(!LS.get('products')) LS.set('products',[
    {name:'×—×•×œ×¦×ª ×¤×•×œ×• ×××‘×¨', sku:'M250216', cat:'×—×•×œ×¦×•×ª', price:119.90, img:''},
    {name:'×’×³×™× ×¡ ×œ×‘×Ÿ ×¨×—×‘', sku:'G199990', cat:'×’×³×™× ×¡×™×', price:199.90, img:''},
    {name:'×¡× ×™×§×¨×¡ Gaimi ×—×•×', sku:'S149900', cat:'× ×¢×œ×™×™×', price:149.90, img:''},
  ]);
  if(!LS.get('inventory')) LS.set('inventory',[]);
  if(!LS.get('sales')) LS.set('sales',[]);
  if(!LS.get('goals')) LS.set('goals',{daily:2000,weekly:12000});
  if(!LS.get('time')) LS.set('time',[]); // {id,user,in, out}
  if(!LS.get('shortages')) LS.set('shortages',[]);
  if(!LS.get('shortUserFeed')) LS.set('shortUserFeed',[]);
})();
document.getElementById('year').textContent=new Date().getFullYear();

/* ===== Router ===== */
const views=['search','shortage','auth','register','admin'];
function showView(name){
  views.forEach(id=>{
    const el=$("#view-"+id);
    if(!el) return;
    const on = (id===name);
    el.style.display = on?'grid':'none';
    setTimeout(()=> el.classList.toggle('active',on), on?10:0);
  });
  if(name==='search') { renderResults([]); }
  if(name==='shortage'){ renderShortUserFeed(); }
  if(name==='admin'){ ensureAdmin(); renderAdmin(); }
}

/* ===== Auth ===== */
function currentUser(){ return LS.get('currentUser',null) }
function updateAuthUI(){
  const cu=currentUser();
  $("#loginBtn").style.display = cu?'none':'inline-block';
  $("#logoutBtn").style.display = cu?'inline-block':'none';
  $("#adminBtn").style.display  = (cu && cu.role==='admin')?'inline-block':'none';
}
function ensureAdmin(){ const cu=currentUser(); if(!cu || cu.role!=='admin'){ alert('× ×“×¨×©×ª ×›× ×™×¡×ª ××“××™×Ÿ'); showView('auth'); } }
function login(){
  const u=$("#loginUser").value.trim(), p=$("#loginPass").value;
  const users=LS.get('users',[]), found=users.find(x=>x.username===u && x.pass===p);
  if(!found){ toast('×©× ××©×ª××© ××• ×¡×™×¡××” ×œ× × ×›×•× ×™×','danger'); return }
  LS.set('currentUser',{username:found.username, full:found.full||found.username, role:found.role});
  updateAuthUI(); toast('×‘×¨×•×š ×”×‘×, '+(found.full||u),'ok'); showView(found.role==='admin'?'admin':'search');
}
function logout(){ localStorage.removeItem('currentUser'); updateAuthUI(); toast('×”×ª× ×ª×§×ª','warn'); showView('auth'); }
function register(){
  const u=$("#regUser").value.trim(), p=$("#regPass").value, full=$("#regFull").value.trim(), role=$("#regRole").value;
  if(!u||!p){ toast('×”×›× ×¡ ×©× ×•×¡×™×¡××”','warn'); return }
  let users=LS.get('users',[]); if(users.some(x=>x.username===u)){ toast('×©× ×ª×¤×•×¡','danger'); return }
  users.push({username:u, full:full||u, pass:p, role:role||'user', created:Date.now()});
  LS.set('users',users); toast('× ×•×¦×¨ ×—×©×‘×•×Ÿ ×—×“×©','ok'); showView('auth');
}
updateAuthUI();

/* ===== Search ===== */
function clearSearch(){ $("#qName").value=''; $("#qSku").value=''; renderResults([]); }
function search(){
  const name=$("#qName").value.trim().toLowerCase();
  const sku =$("#qSku").value.trim().toLowerCase();
  const cat =$("#filterCat").value;
  const priceRange=$("#filterPrice").value;
  const prods=LS.get('products',[]);
  const res=prods.filter(p=>{
    const byName= name? p.name.toLowerCase().includes(name):true;
    const bySku = sku? (p.sku.toLowerCase()===sku || p.sku.toLowerCase().includes(sku)):true;
    const byCat = cat? p.cat===cat : true;
    const byPrice = !priceRange ? true :
      (priceRange==='1'? p.price<=100 : priceRange==='2'? (p.price>100 && p.price<=200) : p.price>200);
    return byName && bySku && byCat && byPrice;
  });
  renderResults(res);
}
function renderResults(arr){
  const wrap=$("#resultsList"); wrap.innerHTML='';
  if(!arr || arr.length===0){ wrap.innerHTML='<div class="empty">××™×Ÿ ×ª×•×¦××•×ªâ€¦ × ×¡×” ×©×/××§×´×˜ ××—×¨</div>'; return }
  arr.forEach(p=>{
    const card=document.createElement('div'); card.className='card';
    const img=p.img||'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22110%22 height=%22110%22><rect width=%22110%22 height=%22110%22 fill=%22%2313161f%22/><text x=%2250%25%22 y=%2250%25%22 fill=%22%23aab2c5%22 font-size=%2212%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>no image</text></svg>';
    card.innerHTML = `<div class="prod">
      <img src="${img}" alt="×ª××•× ×”"/>
      <div>
        <div class="pill">××§×´×˜: <b>${p.sku}</b> â€¢ ${p.cat||'â€“'}</div>
        <h3 style="margin-top:6px">${p.name}</h3>
        <div style="margin-top:6px" class="pill">â‚ª ${Number(p.price).toFixed(2)}</div>
      </div>
    </div>`;
    wrap.appendChild(card);
  });
}

/* ===== Admin Tabs ===== */
function setAdminTab(tab){
  ['products','inventory','sales','goals','time','shortages','users','reports'].forEach(id=>{
    const el=$("#admin-"+id);
    if(el) el.style.display = (id===tab)?'block':'none';
  });
  if(tab==='products') renderAdminProducts();
  if(tab==='inventory') renderInventory();
  if(tab==='sales') { fillUsersSelects(); renderSales(); }
  if(tab==='goals') renderGoals();
  if(tab==='time')  { fillUsersSelects(); renderTime(); }
  if(tab==='shortages') renderAdminShortages();
  if(tab==='users') renderUsers();
}

/* ===== Products ===== */
function saveProduct(){
  const name=$("#pName").value.trim(), sku=$("#pSku").value.trim(), cat=$("#pCat").value, price=parseFloat($("#pPrice").value||'0'), img=$("#pImg").value.trim();
  if(!name||!sku){ toast('×©× ×•××§×´×˜ × ×“×¨×©×™×','warn'); return }
  const prods=LS.get('products',[]); const i=prods.findIndex(p=>p.sku.toLowerCase()===sku.toLowerCase());
  if(i>-1) prods[i]={...prods[i],name,cat,price,img}; else prods.push({name,sku,cat,price,img});
  LS.set('products',prods); renderAdminProducts(); clearProductForm(); toast('××•×¦×¨ × ×©××¨','ok');
}
function renderAdminProducts(){
  const wrap=$("#adminProdList"); wrap.innerHTML='';
  const prods=LS.get('products',[]); if(prods.length===0){ wrap.innerHTML='<div class="empty">××™×Ÿ ××•×¦×¨×™×</div>'; return }
  prods.forEach(p=>{
    const div=document.createElement('div'); div.className='card';
    const img=p.img||'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22110%22 height=%22110%22><rect width=%22110%22 height=%22110%22 fill=%22%2313161f%22/></svg>';
    div.innerHTML=`<div class="prod">
      <img src="${img}" alt="">
      <div>
        <div class="pill">SKU: <b>${p.sku}</b> â€¢ ${p.cat||'â€“'}</div>
        <h3 style="margin:6px 0">${p.name}</h3>
        <div class="pill">â‚ª ${Number(p.price).toFixed(2)}</div>
        <div class="actions" style="margin-top:8px">
          <button class="btn ripple" type="button" onclick='fillProductForm(${JSON.stringify(JSON.stringify(p))})'>×¢×¨×•×š</button>
          <button class="btn ripple" type="button" onclick='deleteProduct("${p.sku}")'>××—×§</button>
        </div>
      </div>
    </div>`;
    wrap.appendChild(div);
  });
}
function fillProductForm(json){ const p=JSON.parse(json); $("#pName").value=p.name; $("#pSku").value=p.sku; $("#pCat").value=p.cat||'××—×¨'; $("#pPrice").value=p.price; $("#pImg").value=p.img||''; window.scrollTo({top:0,behavior:'smooth'}); }
function deleteProduct(sku){ if(!confirm('×œ××—×•×§ ××•×¦×¨?')) return; const prods=LS.get('products',[]).filter(p=>p.sku!==sku); LS.set('products',prods); renderAdminProducts(); toast('× ××—×§','ok'); }
function clearProductForm(){ ['pName','pSku','pPrice','pImg'].forEach(id=> $("#"+id).value=''); $("#pCat").value='××—×¨'; }

/* ===== Inventory ===== */
function saveInventory(){
  const sku=$("#invSku").value.trim(), qty=parseInt($("#invQty").value||'0',10), loc=$("#invLoc").value.trim(), attr=$("#invAttr").value.trim();
  if(!sku){ toast('××§×´×˜ × ×“×¨×©','warn'); return } if(qty<0||Number.isNaN(qty)){ toast('×›××•×ª ×œ× ×ª×§×™× ×”','warn'); return }
  let inv=LS.get('inventory',[]); const i=inv.findIndex(r=>r.sku.toLowerCase()===sku.toLowerCase()&&(r.loc||'')===loc&&(r.attr||'')===attr);
  const now=Date.now(); if(i>-1){ inv[i]={...inv[i],qty,loc,attr,ts:now} } else { inv.push({id:crypto.randomUUID(),sku,qty,loc,attr,ts:now}) }
  LS.set('inventory',inv); renderInventory(); clearInvForm(); toast('××œ××™ × ×©××¨','ok');
}
function renderInventory(){
  const data=LS.get('inventory',[]), tbody=$("#invTable tbody"), empty=$("#invEmpty"); tbody.innerHTML='';
  if(data.length===0){ empty.style.display='block'; return } else { empty.style.display='none'; }
  data.slice().reverse().forEach(r=>{
    const tr=document.createElement('tr'); const d=new Date(r.ts).toLocaleString('he-IL');
    tr.innerHTML=`<td>${r.sku}</td><td>${r.qty}</td><td>${r.loc||''}</td><td>${r.attr||''}</td><td>${d}</td>
      <td><button class="btn ripple" type="button" onclick="delInv('${r.id}')">××—×§</button></td>`;
    tbody.appendChild(tr);
  });
}
function delInv(id){ let data=LS.get('inventory',[]).filter(x=>x.id!==id); LS.set('inventory',data); renderInventory(); toast('× ××—×§','ok'); }
function clearInvForm(){ ['invSku','invQty','invLoc','invAttr'].forEach(id=> $("#"+id).value=''); }

/* ===== Sales ===== */
function fillUsersSelects(){
  const users=LS.get('users',[]);
  const u1=$("#saleUser"), u2=$("#timeUser");
  if(u1){ u1.innerHTML = users.map(u=><option>${u.username}</option>).join(''); }
  if(u2){ u2.innerHTML = users.map(u=><option>${u.username}</option>).join(''); }
}
function saveSale(){
  const user=$("#saleUser").value, sku=$("#saleSku").value.trim(), qty=parseInt($("#saleQty").value||'1',10), total=parseFloat($("#saleTotal").value||'0');
  if(!user||!sku||qty<=0){ toast('×”×©×“×” ×—×¡×¨','warn'); return }
  const sales=LS.get('sales',[]); sales.push({id:crypto.randomUUID(), user, sku, qty, total, ts:Date.now()});
  LS.set('sales',sales); renderSales(); clearSaleForm(); toast('× ×©××¨×” ××›×™×¨×”','ok'); updateGoalsProgress();
}
function renderSales(){
  const data=LS.get('sales',[]), tbody=$("#salesTable tbody"), empty=$("#salesEmpty"); tbody.innerHTML='';
  if(data.length===0){ empty.style.display='block'; return } else { empty.style.display='none'; }
  data.slice().reverse().forEach(r=>{
    const tr=document.createElement('tr'); const d=new Date(r.ts).toLocaleString('he-IL');
    tr.innerHTML=`<td>${d}</td><td>${r.user}</td><td>${r.sku}</td><td>${r.qty}</td><td>â‚ª ${Number(r.total).toFixed(2)}</td>
      <td><button class="btn ripple" type="button" onclick="delSale('${r.id}')">××—×§</button></td>`;
    tbody.appendChild(tr);
  });
}
function delSale(id){ let data=LS.get('sales',[]).filter(x=>x.id!==id); LS.set('sales',data); renderSales(); toast('× ××—×§','ok'); updateGoalsProgress(); }
function clearSaleForm(){ ['saleSku','saleQty','saleTotal'].forEach(id=> $("#"+id).value=''); }

/* ===== Goals ===== */
function renderGoals(){ const g=LS.get('goals',{daily:0,weekly:0}); $("#goalDaily").value=g.daily; $("#goalWeekly").value=g.weekly; updateGoalsProgress(); }
function saveGoals(){ const daily=parseInt($("#goalDaily").value||'0',10), weekly=parseInt($("#goalWeekly").value||'0',10); LS.set('goals',{daily,weekly}); updateGoalsProgress(); toast('×™×¢×“×™× × ×©××¨×•','ok'); }
function sumSalesIn(days){ const since=Date.now() - days*86400000; return LS.get('sales',[]).filter(s=>s.ts>=since).reduce((a,b)=>a+(+b.total||0),0); }
function updateGoalsProgress(){
  const g=LS.get('goals',{daily:0,weekly:0});
  const d=sumSalesIn(1), w=sumSalesIn(7);
  $("#goalsProgress").textContent = ×”×ª×§×“××•×ª: ×™×•× ${d}/${g.daily} â‚ª â€¢ ×©×‘×•×¢ ${w}/${g.weekly} â‚ª;
}

/* ===== Time Clock ===== */
function clockIn(){ const u=$("#timeUser").value; if(!u){toast('×‘×—×¨ ×¢×•×‘×“','warn');return} const t=LS.get('time',[]); t.push({id:crypto.randomUUID(),user:u,in:Date.now(),out:null}); LS.set('time',t); renderTime(); toast('Clock-in','ok'); }
function clockOut(){
  const u=$("#timeUser").value; if(!u){toast('×‘×—×¨ ×¢×•×‘×“','warn');return}
  const t=LS.get('time',[]); const open=t.slice().reverse().find(x=>x.user===u && !x.out); if(!open){toast('××™×Ÿ ×›× ×™×¡×” ×¤×ª×•×—×”','warn');return}
  open.out=Date.now(); LS.set('time',t); renderTime(); toast('Clock-out','ok');
}
function renderTime(){
  const data=LS.get('time',[]), tbody=$("#timeTable tbody"), empty=$("#timeEmpty"); tbody.innerHTML='';
  if(data.length===0){ empty.style.display='block'; return } else { empty.style.display='none'; }
  data.slice().reverse().forEach(r=>{
    const tr=document.createElement('tr'); const ih=new Date(r.in).toLocaleString('he-IL'); const oh=r.out? new Date(r.out).toLocaleString('he-IL'): 'â€”';
    const hours = r.out? (((r.out - r.in)/3600000)).toFixed(2) : 'â€”';
    tr.innerHTML=`<td>${r.user}</td><td>${ih}</td><td>${oh}</td><td>${hours}</td>
      <td><button class="btn ripple" type="button" onclick="delTime('${r.id}')">××—×§</button></td>`;
    tbody.appendChild(tr);
  });
}
function delTime(id){ let data=LS.get('time',[]).filter(x=>x.id!==id); LS.set('time',data); renderTime(); toast('× ××—×§','ok'); }

/* ===== Shortages ===== */
function submitShortage(){
  const cu=currentUser(), who=cu? (cu.full||cu.username) : '××•×¨×—';
  const item=$("#shortItem").value.trim(), qty=parseInt($("#shortQty").value||'0',10), note=$("#shortNote").value.trim();
  if(!item || qty<=0){ toast('×”×›× ×¡ ×¤×¨×™×˜ ×•×›××•×ª','warn'); return }
  const list=LS.get('shortages',[]); list.push({id:crypto.randomUUID(),by:who,item,qty,note,ts:Date.now()}); LS.set('shortages',list);
  const feed=LS.get('shortUserFeed',[]); feed.unshift({item,qty,by:who,ts:Date.now()}); LS.set('shortUserFeed',feed.slice(0,20));
  renderShortUserFeed(); $("#shortItem").value=''; $("#shortQty").value=''; $("#shortNote").value=''; toast('× ×©×œ×—','ok');
}
function renderShortUserFeed(){
  const feed=LS.get('shortUserFeed',[]), box=$("#shortUserList"); box.innerHTML='';
  if(feed.length===0){ box.innerHTML='<div class="empty">××™×Ÿ ×“×™×•×•×—×™×</div>'; return }
  feed.forEach(r=>{
    const d=new Date(r.ts).toLocaleString('he-IL'); const div=document.createElement('div'); div.className='card';
    div.innerHTML = <b>${r.item}</b> â€” ×›××•×ª: <b>${r.qty}</b> <span class="muted">(${d})</span><br/><span class="muted">×“×•×•×— ×¢×´×™: ${r.by}</span>;
    box.appendChild(div);
  });
}
function renderAdminShortages(){
  const data=LS.get('shortages',[]), tbody=$("#shortTable tbody"); tbody.innerHTML='';
  if(data.length===0){ $("#emptyShort").style.display='block'; return } else { $("#emptyShort").style.display='none'; }
  data.slice().reverse().forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${new Date(r.ts).toLocaleString('he-IL')}</td><td>${r.by}</td><td>${r.item}</td><td>${r.qty}</td><td>${r.note||''}</td>
      <td><button class="btn ripple" type="button" onclick="resolveShortage('${r.id}')">×¡×•××Ÿ ×˜×•×¤×œ</button></td>`;
    tbody.appendChild(tr);
  });
}
function resolveShortage(id){ let data=LS.get('shortages',[]).filter(x=>x.id!==id); LS.set('shortages',data); renderAdminShortages(); toast('×¢×•×“×›×Ÿ','ok'); }

/* ===== Users ===== */
function renderUsers(){
  const users=LS.get('users',[]), tbody=$("#usersTable tbody"); tbody.innerHTML='';
  users.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${u.username}</td><td>${u.full||''}</td><td>${u.role}</td><td>${new Date(u.created).toLocaleDateString('he-IL')}</td>
      <td>${u.role!=='admin'?<button class="btn ripple" type="button" onclick="delUser('${u.username}')">××—×§</button>:''}</td>`;
    tbody.appendChild(tr);
  });
}
function delUser(username){ if(!confirm('×œ××—×•×§ ××©×ª××©?')) return; let users=LS.get('users',[]).filter(u=>u.username!==username); LS.set('users',users); renderUsers(); toast('× ××—×§','ok'); }

/* ===== Reports + Chart (vanilla canvas) ===== */
function buildReport(){
  const days = parseInt($("#repDays").value||'7',10);
  const sales = LS.get('sales',[]);
  const now=Date.now(), dayMs=86400000;
  // buckets
  const labels=[], sums=[];
  for(let i=days-1;i>=0;i--){ const dayStart = new Date(now - i*dayMs); dayStart.setHours(0,0,0,0);
    const dayEnd = new Date(dayStart.getTime()+dayMs);
    const s = sales.filter(x=> x.ts>=dayStart.getTime() && x.ts<dayEnd.getTime()).reduce((a,b)=>a+(+b.total||0),0);
    labels.push(dayStart.toLocaleDateString('he-IL')); sums.push(s);
  }
  drawChart(labels, sums);
  const total = sums.reduce((a,b)=>a+b,0);
  $("#repSummary").textContent = ×¡×š ×”×›×œ ×œ×ª×§×•×¤×”: â‚ª ${total.toFixed(2)};
}
function drawChart(labels, data){
  const c=$("#chart"), ctx=c.getContext('2d'); const w=c.width, h=c.height;
  ctx.clearRect(0,0,w,h);
  const max=Math.max(...data, 10);
  const pad=40, bw=(w-pad*2)/data.length*0.7, gap=(w-pad*2)/data.length*0.3;
  // axes
  ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--muted'); ctx.lineWidth=1;
  ctx.beginPath(); ctx.moveTo(pad, h-pad); ctx.lineTo(w-pad, h-pad); ctx.moveTo(pad,h-pad); ctx.lineTo(pad,pad); ctx.stroke();
  // bars
  const col=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()||'#6aa5ff';
  for(let i=0;i<data.length;i++){
    const x=pad + i*(bw+gap) + gap/2; const barH = Math.round((h-pad*2)*(data[i]/max));
    ctx.fillStyle=col; ctx.fillRect(x, h-pad-barH, bw, barH);
  }
  // labels
  ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--muted'); ctx.font='12px Heebo, Arial';
  for(let i=0;i<labels.length;i++){ const x=pad + i*(bw+gap) + gap/2; ctx.fillText(labels[i], x, h-pad+14); }
}

/* ===== Export / Import / CSV ===== */
function exportData(){
  const data={users:LS.get('users',[]),products:LS.get('products',[]),inventory:LS.get('inventory',[]),sales:LS.get('sales',[]),goals:LS.get('goals',{}),time:LS.get('time',[]),shortages:LS.get('shortages',[]),shortUserFeed:LS.get('shortUserFeed',[])};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='backup.json'; a.click(); URL.revokeObjectURL(url); toast('×™×•×¦× JSON','ok');
}
function importData(evt){
  const f=evt.target.files[0]; if(!f) return;
  const r=new FileReader(); r.onload=e=>{ try{ const data=JSON.parse(e.target.result); Object.entries(data).forEach(([k,v])=>LS.set(k,v));
    toast('×™×•×‘× ×‘×”×¦×œ×—×”','ok'); renderAdmin(); }catch{ toast('×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ','danger'); } }; r.readAsText(f);
}
function exportCSV(){
  const prods=LS.get('products',[]); const rows=[['sku','name','cat','price']].concat(prods.map(p=>[p.sku,p.name,p.cat||'',p.price]));
  dlCSV(rows,'products.csv');
}
function exportTimesCSV(){
  const t=LS.get('time',[]); const rows=[['user','in','out','hours']].concat(t.map(r=>[r.user,new Date(r.in).toISOString(),r.out?new Date(r.out).toISOString():'', r.out?((r.out-r.in)/3600000).toFixed(2):'']));
  dlCSV(rows,'time.csv');
}
function dlCSV(rows, name){
  const csv = rows.map(r=>r.map(x=>"${String(x).replace(/"/g,'""')}").join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=name; a.click(); URL.revokeObjectURL(url); toast('CSV ××•×›×Ÿ','ok');
}

/* ===== Master render ===== */
function renderAdmin(){
  renderAdminProducts(); renderInventory(); renderSales(); renderGoals(); renderTime(); renderAdminShortages(); renderUsers(); fillUsersSelects();
}

/* ===== Make functions globally available (for onclick safety) ===== */
Object.assign(window,{
  showView,setAdminTab,
  login,logout,register,updateAuthUI,ensureAdmin,
  search,clearSearch,
  saveProduct,renderAdminProducts,fillProductForm,deleteProduct,clearProductForm,
  saveInventory,renderInventory,delInv,clearInvForm,
  saveSale,renderSales,delSale,clearSaleForm,
  renderGoals,saveGoals,updateGoalsProgress,
  clockIn,clockOut,renderTime,delTime,exportTimesCSV,
  submitShortage,renderShortUserFeed,renderAdminShortages,resolveShortage,
  renderUsers,delUser,buildReport,drawChart,
  exportData,importData,exportCSV,dlCSV,renderAdmin,
  switchTheme
});

/* ===== Init ===== */
renderAdminProducts(); renderShortUserFeed(); updateGoalsProgress();
</script>
</body>
</html>
